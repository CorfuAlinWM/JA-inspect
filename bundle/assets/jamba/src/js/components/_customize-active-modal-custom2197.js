var CustomizeActiveModalComponent=function(n,t,i){function c(){function t(){r.find('a[data-open="modal-component"]').on("click",function(t){var i,u;t.preventDefault();i=n(this).attr("data-container-id");i&&(u=n(".content-container[data-container="+i+"]").html(),r.trigger("show.modal",[u,t]))});r.find('button[data-open="modal-component"]').on("click",function(t){var i,u;t.preventDefault();i=n(this).attr("data-container-id");i&&(u=n(".content-container[data-container="+i+"]").html(),r.trigger("show.modal",[u,t]))})}function c(t){t.find("[data-ref=substitute]").off().on("click",function(){var i=n(this),f=i.data("id"),u=t.find("[data-ref=substitute]"),r;u.removeClass("selected");u.attr("aria-pressed","false");i.addClass("selected");i.attr("aria-pressed","true");r=t.find("[data-ref=save-button]");r.data("id",f);r.removeClass("d-none");r.attr("data-customization-selected",i.data("customization-selected"))})}function l(t,i){var r=new n.Deferred,f;return!u||!u.hasOwnProperty(i)?(f=t.data("action-url")+"&ingredientId="+i,n.ajax({url:f,method:"GET"}).done(function(n){if(!n||!n.item||!n.items||!n.items.length){r.reject("no items");return}u||(u={});u[i]=n;r.resolve(n)}).fail(function(n){r.reject(n)}),r.promise()):r.resolve(u[i])}function a(t,i,r){var u=new n.Deferred,f=i.find("[data-ref=save-button]"),e;return f.addClass("d-none"),f.data("id",""),e=r.data("id"),l(t,e).done(function(n){var t,r;(h=[],n&&n.item&&n.items&&n.items.length)&&(o=n.item,t=s({items:[n.item],original:!0}),i.find("[data-ref=content-ingredient]").html(t),h=n.items,r=new RegExp("^"+n.item.title+"$","i"),t=s({items:n.items.filter(function(n){return!r.test(n.title)})}),i.find("[data-ref=content-substitutions]").html(t),c(i),u.resolve(n))}).fail(function(n){console.log(n);u.reject(n)}),u.promise()}r.on("modal.loaded",function(t,u,s){if(s&&s.currentTarget&&(f=n(s.currentTarget),f.data("container-id")===e.data("container"))){var c=r.find("[data-ref=save-button]");a(e,r,f,c).done(function(){r.trigger("lazy-loading",s);var n=r.find("[data-ref=save-button]");n.length&&(n.attr("data-product-name",f.data("product-name")),n.attr("data-customization-item",f.data("customization-item")))}).fail(function(){r.trigger("lazy-loading",s)});r.find("[data-ref=save-button]").off().on("click",function(t){t.preventDefault();var u=n(this).data("id"),r=h.find(function(n){return n.id===u});r&&o&&(o.substitute=r,i.addOrUpdateIngredient(o),n(document).trigger("ingredient.substitute.success"))});r.find("[data-ref=cancel-button]").off().on("click",function(){n(document).trigger("ingredient.substitute.cancel")})}});n(document).on("shown.modal.ingredient",function(){t()})}function l(){if(e.length){var n=e.find("[data-ref=template]").html();s=t.compile(n);c()}}var s=null,e=n("body").find("[data-component=customize-active-modal-component]"),r=n("body").find(".modal-component"),h=[],o=null,f=null,u=null;return{init:l,open:open,close:close}}(jQuery,Handlebars,TemporaryProductStorage);$(window).on("load",function(){CustomizeActiveModalComponent.init()})