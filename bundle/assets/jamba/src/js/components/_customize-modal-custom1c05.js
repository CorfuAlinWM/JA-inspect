var CustomizeModalComponent=function(n,t,i){function s(){function t(r,u,f){u.find("[data-ref=reset-button]").off().on("click",function(e){e.preventDefault();i.clearIngredients();u.find(".submit").focus();var o=n(this);s(r,u,f).done(function(){}).fail(function(){});t(r,u,f);u.find("[data-ref=reset-button]").addClass("d-none")});u.find("[data-close=modal-component]").off().on("click",function(){u.trigger("close.modal")})}function h(t){var i=new n.Deferred;return e?i.resolve(e):(n.ajax({url:t.data("action-url"),method:"GET"}).done(function(n){if(!n||!n.items||!n.items.length){i.reject("no items");return}e=n;i.resolve(n)}).fail(function(n){i.reject(n)}),i.promise())}function s(t,r){var u=new n.Deferred;return h(t).done(function(t){var f,h,e,c,s,l;if(r.find("[data-ref=reset-button]").addClass("d-none"),!t||!t.items||!t.items.length){u.reject();return}for(f={items:JSON.parse(JSON.stringify(t.items))},h=i.getCart(),h.ingredients&&h.ingredients.length>0&&r.find("[data-ref=reset-button]").removeClass("d-none"),e=0;e<f.items.length;e++)(c=f.items[e].id,s=i.findIngredientById(c),s&&s.substitute)&&n.extend(!0,f.items[e],s);l=o(f);r.find("[data-ref=content]").html(l);n(document).trigger("shown.modal.ingredient",f);u.resolve()}).fail(function(n){u.reject();console.log(n)}),u.promise()}u.on("modal.loaded",function(i,e,o){if(o&&o.currentTarget){var h=n(o.currentTarget);h.data("container-id")===f.data("container")&&(r=h,s(f,u,r).done(function(){u.trigger("lazy-loading",o);u.find("[data-ref=item]").each(function(){r.length&&n(this).attr("data-product-name",r.data("product-name"))})}).fail(function(){u.trigger("lazy-loading",o)}),t(f,u,r))}});n(document).on("ingredient.substitute.success",function(){setTimeout(function(){r.click()},1)});n(document).on("ingredient.substitute.cancel",function(){setTimeout(function(){r.click()},1)})}function h(){if(f.length){var n=f.find("[data-ref=template]").html();o=t.compile(n);s()}}var o=null,f=n("body").find("[data-component=customize-modal-component]"),u=n("body").find(".modal-component"),r=null,e=null;return{init:h,open:open,close:close}}(jQuery,Handlebars,TemporaryProductStorage);$(window).on("load",function(){CustomizeModalComponent.init()})